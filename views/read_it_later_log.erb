<link rel="stylesheet" href="/css/markdown.css">
<%
	f = File.open(Dir.pwd + "/data/bookmarks.log", "r").read
    
	bookmarks = {}
    db = SQLite3::Database.open(Dir.pwd + "/data/bookmarks.db")
    db.execute("SELECT * FROM bookmarks ORDER BY watched_time DESC") do |row|
    	bookmarks[row[0]] = {
      							:url => row[1],
      							:watched_time => row[2][0..-7],
      							:title => row[3],
      							:starred => (row[4] == 'true'),
      							:note => row[5]
      						}
    end
    db.close
	
	log = []
	h = Hash.new(0)
	table_log =<<TAB
visited time | url
-------------|-----
TAB
	f.scan(/^\[(.+?)\]\s(.+)$/).each do |m|
		log << {
			   	  visited_time: m[0],
			   	  url: m[1]
			   }
		h[m[1]] += 1
		table_log += "#{m[0]} | #{m[1]}\n"
	end
	
	table_frq =<<TAB
title | url | ❤️ | count
------|-----|----|------
TAB
	h.each do |url, count|
		title = bookmarks.select { |k, v| url == v[:url] }.values.first[:title].gsub('|', '--')
		fav = bookmarks.select { |k, v| url == v[:url] }.values.first[:starred]
		table_frq += "#{title} | #{url} | #{fav} | #{count}\n"
	end
%>

<%= Kramdown::Document.new(table_log).to_html %>
<%= Kramdown::Document.new(table_frq).to_html %>