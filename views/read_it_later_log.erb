<link rel="stylesheet" href="/css/markdown.css">
<%
	f = File.open(Dir.pwd + "/data/bookmarks.log", "r").read
    
	bookmarks = {}
    db = SQLite3::Database.open(Dir.pwd + "/data/bookmarks.db")
    db.execute("SELECT * FROM bookmarks ORDER BY watched_time DESC") do |row|
    	bookmarks[row[0]] = {
      							:url => row[1],
      							:watched_time => row[2][0..-7],
      							:title => row[3],
      							:starred => (row[4] == 'true'),
      							:note => row[5]
      						}
    end
    db.close
	
	log = []
	h = Hash.new(0)
	table_log = <<TAB
visited time | url
-------------|-----
TAB
	f.scan(/^\[(.+?)\]\s(.+)$/).each do |m|
		log << {
			   	  visited_time: m[0],
			   	  url: m[1]
			   }
		h[m[1]] += 1
		table_log += "#{m[0]} | #{m[1]}\n"
	end
	
	table_frq = <<TAB
title | url | â¤ï¸ | count
------|-----|----|------
TAB
	h.each do |url, count|
		title = bookmarks.select { |k, v| url == v[:url] }.values.first[:title].gsub('|', '--')
		fav = bookmarks.select { |k, v| url == v[:url] }.values.first[:starred]
		table_frq += "#{title} | #{url} | #{fav} | #{count}\n"
	end
	
	md = <<MD
# æ›¸ç±¤åƒ¹å€¼è¨ˆç®—å…¬å¼

- æ¯è¨ªå•éŽ 1 æ¬¡ï¼Œ`+1`ï¼›
- åŠ â¤ï¸ï¼Œ`+3`ï¼›
- ï¼ˆæš«æ™‚å°±æƒ³åˆ°é€™éº¼å¤šðŸ˜“ï¼‰

# TODO

- åœ¨æœç´¢æ›¸ç±¤æ™‚æŒ‰ç…§ã€Œæ›¸ç±¤åƒ¹å€¼ã€æŽ’åºï¼›
- çµ±è¨ˆåˆ†æžè’è—æ›¸ç±¤çš„ä¸»é¡Œè©žï¼›
- åˆ†æžå„æ™‚æ®µçš„é—œæ³¨é»žï¼›
- å°æ›¸ç±¤çš„ä¸»ç¶²ç«™è©•åƒ¹ï¼ˆæ¯”å¦‚ï¼šæŸå€‹é«˜è³ªé‡çš„åšä¸»ï¼‰ï¼›


# è¨ªå•è¨˜éŒ„

#{table_log}


# è¨ªå•é é¢çµ±è¨ˆ

#{table_frq}

MD

%>

<%= Kramdown::Document.new(md).to_html %>